<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0"></script>
  <style>
    /* Add a tiny bit of width reduction to the navbar */
    nav {
      width: 95%; /* reduced width by 5% */
      margin: 0 auto;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #333;
      color: white;
    }

    .navbar-links {
      display: flex;
      gap: 10px;
    }

    .navbar-links a {
      color: white;
      text-decoration: none;
    }

    .navbar-links a:hover {
      text-decoration: underline;
    }

    /* Style for the logout button in the top-right */
    .logout-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: red;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
    }

    .logout-btn:hover {
      background-color: darkred;
    }

    /* Style for the start earning button */
    .start-earning-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
    }

    .start-earning-btn:hover {
      background-color: #45a049;
    }

    /* Style for coin display */
    .coin-display {
      font-size: 20px;
      margin-top: 20px;
    }

    /* Progress bar styling */
    .progress-container {
      width: 100%;
      height: 20px;
      background-color: #f3f3f3;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #4CAF50;
      border-radius: 10px;
    }

  </style>
</head>
<body>
  <div id="dashboard">
    <!-- Navbar with the logout button -->
    <nav>
      <div class="navbar-links">
        <a href="/home">Home</a>
        <a href="/profile">Profile</a>
        <a href="/settings">Settings</a>
      </div>
      <button class="logout-btn" id="logout-btn">Logout</button>
    </nav>

    <!-- Content -->
    <div class="content">
      <h1>Welcome to your Dashboard</h1>
      <p id="welcome-message"></p>

      <!-- Coins and Start Earning button -->
      <button class="start-earning-btn" id="start-earning-btn">Start Earning</button>

      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>

      <div class="coin-display">
        <p id="coins">Coins: 0</p>
      </div>
    </div>
  </div>

  <script>
    const supabaseUrl = 'https://qvdrfahwyztzpbddoakd.supabase.co';
    const supabaseKey = 'YOUR_SUPABASE_KEY'; // Replace with your actual key
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const logoutButton = document.getElementById("logout-btn");
    const startEarningButton = document.getElementById("start-earning-btn");
    const coinsDisplay = document.getElementById("coins");
    const progressBar = document.getElementById("progress-bar");
    const welcomeMessage = document.getElementById("welcome-message");

    const MAX_COINS = 500; // Maximum coins goal for the progress bar

    // Check if the user is logged in and a member
    async function checkUser() {
      const { data, error } = await supabase.auth.getUser();
      if (error || !data.user) {
        window.location.href = '/login'; // Redirect to login page if not authenticated
      } else {
        // User is authenticated, check for the user's membership
        const user = data.user;
        welcomeMessage.innerText = `Welcome back, ${user.email}!`;

        // Check localStorage for coin data
        const savedCoins = localStorage.getItem('coins');
        if (savedCoins) {
          coinsDisplay.innerText = `Coins: ${savedCoins}`;
          updateProgressBar(savedCoins);
        } else {
          coinsDisplay.innerText = 'Coins: 0';
          updateProgressBar(0);
        }
      }
    }

    // Logout function
    logoutButton.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = '/login'; // Redirect to login page after logout
    });

    // Update the progress bar based on coin count
    function updateProgressBar(coins) {
      const percentage = Math.min((coins / MAX_COINS) * 100, 100); // Calculate percentage, cap at 100%
      progressBar.style.width = `${percentage}%`;
    }

    // Start earning button functionality
    startEarningButton.addEventListener("click", () => {
      let currentCoins = parseInt(localStorage.getItem('coins')) || 0;
      currentCoins += 50; // Add 50 coins
      localStorage.setItem('coins', currentCoins); // Save to local storage
      coinsDisplay.innerText = `Coins: ${currentCoins}`; // Update displayed coins
      updateProgressBar(currentCoins); // Update the progress bar
    });

    // Initialize by checking user status and setting up
    checkUser();
  </script>
</body>
</html>
